# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⣴⣤⣤⣤⣤⣤⡄⢹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⠟⢋⣵⣿⣿⣿⡿⠛⣩⣤⣿⣿⣿⣿⣿⣿⣿⣬⣙⠻⣿⣿⣿⣷⡍⠛⢿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⠟⢹⠃⣠⣾⣿⣿⡿⢋⣴⣿⣿⣿⣿⠿⠿⠈⠿⢿⣿⣿⣿⣷⣤⡙⣿⣿⣿⢦⡀⢣⠙⣿⣿⣿⣿
# ⣿⣿⡿⡿⠀⡯⠊⣡⣿⣿⠏⣴⣿⣿⣿⠟⠁⣀⣤⣤⠀⣤⣤⡀⠙⠻⣿⣿⣿⣌⢻⣿⣧⡉⠺⡄⢸⠹⣿⣿
# ⣿⣿⠃⢷⠀⡠⢺⣿⣿⡏⣰⣿⣿⡟⠁⣠⣾⣿⣿⠿⠀⠿⣿⣿⣷⡄⠘⣿⣿⣿⡄⣿⣿⣯⠢⡀⢸⠀⢹⣿
# ⣿⣿⠀⢸⠊⣠⣿⣿⣿⢀⣿⣿⣿⠁⣰⣿⣿⣿⣿⣆⢀⣼⣿⣿⣿⣿⡄⢸⣿⣿⣿⣹⣿⣿⣦⠈⢺⠀⢸⣿
# ⣿⠹⡆⠀⣴⢻⣿⣿⣿⢸⣿⣿⣿⠀⣿⣿⡿⠿⠿⢿⣿⠿⠿⠿⣿⣿⡇⢈⣿⣿⣿⠀⣿⣿⣿⠳⡀⢀⡇⢸
# ⣿⡀⠹⣸⠉⣿⣿⡿⢋⣠⣿⣿⣿⡀⠸⠟⢋⣀⢠⣾⣿⣷⡀⣀⡙⠻⠁⢸⣿⣿⣿⣈⠻⣿⣿⡄⠹⡜⠀⣸
# ⣿⢧⠀⠇⢠⣿⣿⣷⡘⣿⣿⣿⣟⣁⡀⠘⢿⣿⣿⣿⣿⣿⣿⣿⠿⠀⣠⣉⣿⣿⣿⡿⢠⣿⡿⢧⠀⠁⣰⢿
# ⣿⡌⢷⡄⣾⠀⣿⣿⣷⡜⢿⣿⣿⣿⣿⣦⣄⠈⠉⠛⠛⠛⠉⢁⣠⣾⣿⣿⣿⣿⡟⣰⣿⣿⡇⢸⢀⡴⠃⣼
# ⣿⣷⣄⠙⢿⠀⣿⢿⣿⣿⣌⠿⠟⡻⣿⣿⣿⣿⣷⣶⣶⣶⣿⣿⣿⣿⡿⠛⠿⠟⣼⣿⡿⢫⠃⢸⠋⢀⣼⣿
# ⣿⣿⣟⣶⣄⡀⢸⡀⢻⣿⣿⣾⣿⣿⣶⣍⣙⠛⠿⠿⠿⠿⠿⠛⣋⣥⣶⣿⣿⣾⣿⣿⠁⣸⢀⣴⣶⣯⣿⣿
# ⣿⣿⣿⣿⣿⣿⠾⣧⠀⢯⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⡿⢫⠃⢠⢷⣛⣉⣽⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣄⣁⡈⢧⠈⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⣠⢋⣀⣠⣴⣾⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣯⣉⠉⠉⠉⣀⣀⡭⠟⠛⢛⣛⠛⠛⠛⣛⠛⠛⠩⣥⣀⣈⢁⢀⣀⣴⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣝⡛⢉⣁⣀⣤⠖⣫⣴⣿⣿⣷⣬⡙⣦⣤⣀⡈⣉⣩⣯⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⣼⣿⣿⣿⣿⣿⣿⣿⣧⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
#
#    _____ __________     ____        __        __
#   / ___// ____/ __ \   / __ \____ _/ /_____ _/ /_  ____ _________
#   \__ \/ /   / /_/ /  / / / / __ `/ __/ __ `/ __ \/ __ `/ ___/ _ \
#  ___/ / /___/ ____/  / /_/ / /_/ / /_/ /_/ / /_/ / /_/ (__  )  __/
# /____/\____/_/      /_____/\__,_/\__/\__,_/_.___/\__,_/____/\___/
#
#               Created by Darrel (CatRass#5748)
#
#               Original Creation Date: 29/11/22
#                   Last Edited: 12/03/23

import sys
from PyQt6.QtCore import QSize, Qt
from PyQt6 import sip
from PyQt6.QtWidgets import * 
from PyQt6.QtGui import QPalette, QColor, QIcon, QFont, QFontDatabase, QImage, QPixmap
import requests
import urllib.request

from Modules import SCPScraper

# =======================================================================================

class Color(QWidget):   #   Debug Widget that shows a coloured square
    def __init__(self, color):
        super(Color, self).__init__()
        self.setAutoFillBackground(True)
        palette = self.palette()
        palette.setColor(QPalette.ColorRole.Window, QColor(color))
        self.setPalette(palette)

class TestWindow(QWidget):
    def __init__(self):
        super().__init__()
        self.toolSelector = toolSelector(["SCP's","Tales", "GOI's"])

class toolSelector(QComboBox):  #   Editable ComboBox
    def __init__(self,options):
        super(toolSelector,self).__init__()
        self.addItems(options)

class inputBar(QLineEdit):
    def __init__(self,placeHolderText,returnFunction):
        super(inputBar,self).__init__()
        self.setMaxLength(4)
        self.setPlaceholderText(placeHolderText)
        self.returnPressed.connect(returnFunction)

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        self.setWindowTitle("SCP Database")
        self.setMinimumSize(QSize(400, 300))

        self.setWindowIcon(QIcon('icon.ico'))
        self.toolSelector = toolSelector(["SCP's","Tales"])
        self.scpInput = inputBar("Enter SCP Number",self.scpSearched)
        self.scpInput.setFont(QFont("VT323",15))

        self.button = QPushButton("Search", self)
        self.button.setFixedSize(120, 30)
        self.button.setFont(QFont("VT323",15))
        self.button.clicked.connect(self.scpSearched)

        self.scpSearchedBool = False

        self.layout = QGridLayout()
        self.layout.setAlignment(Qt.AlignmentFlag.AlignTop)
        secondaryLayout = QVBoxLayout()
        self.layout.addWidget(self.scpInput, 0,0)
        self.layout.addWidget(self.button, 0,1)

        self.imageLabel = QLabel(self)
        self.layout.addWidget(self.imageLabel, 1,1)

        self.widget = QWidget()
        self.widget.setLayout(self.layout)
        self.setCentralWidget(self.widget)

    def scpSearched(self):

        scpInfo = SCPScraper.scraper(self.scpInput.text())  #   Store SCPScraper dictionary in a variable
                                                    #   ↑   scpInfo = {"Heading":"text","Heading2":"text"...}
        # self.scpInformation = QWidget() #   Widget to store all SCP Information
        self.scpInfoTextBrowser = QTextEdit(readOnly = False)
        self.scpInfoTextBrowser.clear()
        # self.scpInfoTextBrowser.setStyleSheet("color: grey; background-color: #333232")

        index = 1
        for key in scpInfo:
            self.scpInfoTextBrowser.setFont(QFont("VT323")) #   Sets the text font

            if key == "Image":
                if scpInfo[key] != None:    #   Check if the image exists

                    data = urllib.request.urlopen(scpInfo[key]).read()
                    image = QImage()
                    image.loadFromData(data)
                    imagePixMap = QPixmap(image)
                    imagePixMap= imagePixMap.scaled(256, 256, Qt.AspectRatioMode.KeepAspectRatio)   #   Resize the image keeping the aspect ratio

                    self.imageLabel.setPixmap(imagePixMap)
                    self.show()
                else:
                    self.imageLabel.clear() #   Clear the label if no image exists

            # Parses current text string and logs what has been skipped over
            elif key == "None" or key == "Filename:" or key == "Licensing Disclosures":
                print("{}:\n",scpInfo[key].format(key))

            else:   #   If the entry in allContents is just regular text, put it in the TextBrowser
                self.scpInfoTextBrowser.setFontPointSize(20)
                self.scpInfoTextBrowser.setTextColor(QColor('Red'))
                self.scpInfoTextBrowser.setFontUnderline(True)
                self.scpInfoTextBrowser.append(key)

                self.scpInfoTextBrowser.setFontPointSize(15)
                self.scpInfoTextBrowser.setTextColor(QColor('white'))
                self.scpInfoTextBrowser.setFontUnderline(False)
                self.scpInfoTextBrowser.append(scpInfo[key])

                self.scpInfoTextBrowser.append('')

                index += 1

        self.layout.addWidget(self.scpInfoTextBrowser,1,0)

        self.scpInfoTextBrowser.setReadOnly(True)

        self.scpSearchedBool = True #   Indicate that the page has contents on it


app = QApplication(sys.argv)
window = MainWindow()
window.show()

QFontDatabase.addApplicationFont("/Styles/Fonts/VT323-Regular.ttf") #   Load the font from the .TTF file

stylesheet = open("Styles/stylesheet.css")  #   Load the Style Sheet from the .CSS file
style = stylesheet.read()

app.setStyleSheet(style)    #   Set the style


app.exec()
